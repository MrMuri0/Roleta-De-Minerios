<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Roleta de Min√©rios</title>
  <link href="https://fonts.googleapis.com/css2?family=Rubik+Iso&family=Fredoka:wght@500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background-color: #111;
      color: white;
      font-family: 'Fredoka', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding: 20px 20px 80px;
      position: relative;
    }
    #coinsContainer {
      position: absolute;
      bottom: 20px;
      left: 20px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    #autoMinerBtn {
      margin-bottom: 8px;
      padding: 6px 12px;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      display: none;
    }
    #autoMinerBtn.on { background-color: #2ecc71; color: white; }
    #autoMinerBtn.off { background-color: #e74c3c; color: white; }
    #coinsDisplay {
      font-size: 1.4rem;
      font-weight: bold;
      color: gold;
      text-shadow: 0 0 6px rgba(255,215,0,0.7);
    }
    h1 {
      font-family: 'Rubik Iso', cursive;
      font-size: 6rem;
      margin-bottom: 20px;
      text-align: center;
      line-height: 1;
      text-shadow: 0 4px 8px rgba(0, 0, 0, 0.6);
    }
    #spinButtonContainer { margin-bottom: 12px; }
    .other-buttons {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 30px;
    }
    .btn {
      padding: 14px 32px;
      font-size: 1.3rem;
      border: none;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    #spinButton { background-color: white; color: #111; }
    #backpackButton, #chancesButton, #sellButton, #valuesButton, #shopButton {
      background-color: #333;
      color: white;
    }
    .btn:hover:not(:disabled) { transform: scale(1.06); }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
    #displays {
      width: 100%;
      max-width: 600px;
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-bottom: 25px;
    }
    .display-item {
      width: 100%;
      height: 90px;
      background-color: #222;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.2rem;
      overflow: hidden;
      white-space: nowrap;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    }
    #chestButtons {
      display: none;
      gap: 16px;
      margin-top: 20px;
    }
    #ignoreChest { background-color: #e74c3c; color: white; padding: 12px 24px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
    #openChest { background-color: #2ecc71; color: white; padding: 12px 24px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.85);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background-color: #1a1a1a;
      width: 90%;
      max-width: 550px;
      max-height: 85vh;
      border-radius: 16px;
      padding: 25px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.6);
      display: flex;
      flex-direction: column;
      position: relative;
    }
    .modal-content h2 {
      font-size: 1.8rem;
      margin-bottom: 20px;
      text-align: center;
      color: #ffcc00;
    }
    .shop-item {
      background-color: #222;
      padding: 16px;
      border-radius: 10px;
      margin-bottom: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .shop-info h3 { margin-bottom: 6px; font-size: 1.3rem; }
    .shop-info p { color: #aaa; font-size: 1.1rem; }
    .shop-price { font-weight: bold; color: gold; font-size: 1.3rem; }
    .buy-btn {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
    }
    .buy-btn:hover:not(:disabled) { background-color: #2980b9; }
    .buy-btn:disabled { background-color: #777; cursor: not-allowed; }
    .section-title {
      font-size: 1.4rem;
      margin: 16px 0 10px;
      color: #ffcc00;
      border-bottom: 1px solid #444;
      padding-bottom: 4px;
    }
    .inventory-container, .chances-container, .values-container {
      max-height: 350px;
      overflow-y: auto;
      padding-right: 8px;
    }
    .item-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .inventory-item, .chance-item, .value-item {
      background-color: #222;
      padding: 10px 14px;
      border-radius: 10px;
      font-size: 1.25rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .item-name, .chance-name, .value-name {
      flex: 1;
      text-align: left;
    }
    .item-quantity, .chance-value, .value-amount {
      color: #aaa;
      font-weight: 600;
      min-width: 60px;
      text-align: right;
    }
    .form-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 8px; font-size: 1.2rem; }
    select, input {
      width: 100%;
      padding: 12px;
      font-size: 1.2rem;
      border-radius: 8px;
      border: 1px solid #444;
      background-color: #222;
      color: white;
    }
    .sell-buttons {
      display: flex;
      gap: 16px;
      margin-top: 20px;
    }
    .sell-action {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .sell-btn {
      width: 100%;
      padding: 12px;
      font-size: 1.1rem;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background-color: #2ecc71;
      color: white;
      transition: background 0.2s;
    }
    .sell-btn:hover { background-color: #27ae60; }
    .preview-coins {
      margin-top: 8px;
      font-size: 1rem;
      color: #aaa;
      text-align: center;
    }
    .close-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #ff4d4d;
      color: white;
      width: 32px;
      height: 32px;
      border: none;
      border-radius: 50%;
      font-size: 1.2rem;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }
    .close-btn:hover { background: #ff1a1a; }
    #notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #222;
      color: white;
      border: 2px solid white;
      border-radius: 10px;
      padding: 12px 24px;
      font-size: 1.1rem;
      font-weight: bold;
      z-index: 2000;
      display: none;
      align-items: center;
      gap: 8px;
    }
    .icon-error { color: #ff4d4d; }
    .icon-success { color: #2ecc71; }
  </style>
</head>
<body>
  <h1>Roleta de Min√©rios</h1>

  <div id="spinButtonContainer">
    <button id="spinButton" class="btn">Minerar</button>
  </div>

  <div class="other-buttons">
    <button id="sellButton" class="btn">Vender</button>
    <button id="backpackButton" class="btn">Mochila</button>
    <button id="chancesButton" class="btn">Chances</button>
    <button id="valuesButton" class="btn">Valores</button>
    <button id="shopButton" class="btn">Loja</button>
  </div>

  <div id="displays">
    <div class="display-item" id="display1">Clique em Minerar!</div>
  </div>

  <div id="chestButtons">
    <button id="ignoreChest">Ignorar</button>
    <button id="openChest">Abrir por 500 moedas</button>
  </div>

  <div id="coinsContainer">
    <button id="autoMinerBtn" class="off">Minerador: OFF</button>
    <div id="coinsDisplay">Moedas: 0</div>
  </div>

  <div id="notification">
    <span class="icon" id="notifIcon">‚ùå</span>
    <span id="notifText">Mensagem</span>
  </div>

  <!-- Modais -->
  <div id="shopModal" class="modal">
    <div class="modal-content">
      <button class="close-btn">&times;</button>
      <h2>Loja</h2>
      <div class="shop-item">
        <div class="shop-info">
          <h3>Minerador Autom√°tico</h3>
          <p>Minera sozinho (ignora ba√∫s)</p>
        </div>
        <div>
          <div class="shop-price">1600</div>
          <button class="buy-btn" id="buyAutoMiner">Comprar</button>
        </div>
      </div>
      <div class="shop-item">
        <div class="shop-info">
          <h3>+1 Mina</h3>
          <p>Minera 2 itens por vez</p>
        </div>
        <div>
          <div class="shop-price">4250</div>
          <button class="buy-btn" id="buyDoubleMine">Comprar</button>
        </div>
      </div>
      <div class="shop-item">
        <div class="shop-info">
          <h3>Velocidade 2.0</h3>
          <p>Anima√ß√£o 2x mais r√°pida</p>
        </div>
        <div>
          <div class="shop-price">4500</div>
          <button class="buy-btn" id="buySpeed">Comprar</button>
        </div>
      </div>
    </div>
  </div>

  <div id="backpackModal" class="modal">
    <div class="modal-content">
      <button class="close-btn">&times;</button>
      <h2>Sua Mochila</h2>
      <div class="inventory-container">
        <div id="regularInventory"></div>
        <div id="exclusiveInventory" style="display:none;">
          <div class="section-title">Exclusivos</div>
          <ul id="exclusiveList" class="item-list"></ul>
        </div>
      </div>
    </div>
  </div>

  <div id="chancesModal" class="modal">
    <div class="modal-content">
      <button class="close-btn">&times;</button>
      <h2>Chances dos Itens</h2>
      <div class="chances-container">
        <div id="regularChances"></div>
        <div id="chestChances" style="display:none;">
          <div class="section-title">üéÅ Ba√∫s</div>
          <ul id="chestList" class="item-list"></ul>
        </div>
      </div>
    </div>
  </div>

  <div id="valuesModal" class="modal">
    <div class="modal-content">
      <button class="close-btn">&times;</button>
      <h2>Valores dos Itens</h2>
      <div class="values-container">
        <ul id="valuesList" class="item-list"></ul>
      </div>
    </div>
  </div>

  <div id="sellModal" class="modal">
    <div class="modal-content">
      <button class="close-btn">&times;</button>
      <h2>Vender Itens</h2>
      <div class="form-group">
        <label for="sellItem">Item:</label>
        <select id="sellItem">
          <option value="">Selecione um item</option>
        </select>
      </div>
      <div class="form-group">
        <label for="sellQuantity">Quantidade:</label>
        <input type="number" id="sellQuantity" min="1" value="1">
      </div>
      <div class="sell-buttons">
        <div class="sell-action">
          <button id="convertBtn" class="sell-btn">Vender</button>
          <div id="previewConvert" class="preview-coins">+0 moedas</div>
        </div>
        <div class="sell-action">
          <button id="convertAllBtn" class="sell-btn">Vender tudo</button>
          <div id="previewConvertAll" class="preview-coins">+0 moedas</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const mainItems = [
      { name: 'üå≥ Terra', weight: 17 },
      { name: 'ü™ì Madeira', weight: 12 },
      { name: 'üåë Pedra', weight: 9 },
      { name: '‚¨õ Obsidiana', weight: 8 },
      { name: 'üî© Ferro', weight: 7 },
      { name: 'üî∂ Cobre', weight: 6.5 },
      { name: '‚¨ú Quartzo', weight: 5.2 },
      { name: 'üü£ Ametista', weight: 4 },
      { name: 'üü® Ouro', weight: 2.5 },
      { name: 'üíé Diamante', weight: 1.5 },
      { name: 'üü¢ Esmeralda', weight: 1.2 },
      { name: 'üî¥ Rubi', weight: 0.7 },
      { name: 'üåû Pedra do Sol', weight: 0.5 },
      { name: 'üî∑ Cristal da Lua', weight: 0.02 },
      { name: '‚òÑ Meteorito', weight: 0.007 },
    ];

    const chests = [
      { name: 'üéÅ Ba√∫', weight: 4, items: [
        { name: 'üî¥ Rubi', weight: 0.7 },
        { name: 'üåû Pedra do Sol', weight: 0.5 },
        { name: 'üî∑ Cristal da Lua', weight: 0.2 },
        { name: '‚òÑ Meteorito', weight: 0.1 }
      ]},
      { name: 'üéÅ Ba√∫ Construtivo üß±', weight: 4.5, items: [
        { name: 'üß± Tijolo', weight: 5 },
        { name: 'üî© Ferro', weight: 2.5 },
        { name: '‚öí Cimento', weight: 1.5 }
      ]},
      { name: 'üéÅ Ba√∫ Espacialüåå', weight: 1, items: [
        { name: 'üåï P√≥ lunar', weight: 0.7 },
        { name: 'üí´ Plasma', weight: 0.4 },
        { name: '‚ö´ Mat√©ria escura', weight: 0.006 }
      ]}
    ];

    const exclusiveItems = new Set([
      'üß± Tijolo', '‚öí Cimento', 'üåï P√≥ lunar', 'üí´ Plasma', '‚ö´ Mat√©ria escura'
    ]);

    const itemValues = {
      'üå≥ Terra': 0.5, 'ü™ì Madeira': 1, 'üåë Pedra': 2, '‚¨õ Obsidiana': 5,
      'üî∂ Cobre': 6.5, 'üî© Ferro': 7.5, '‚¨ú Quartzo': 8, 'üü£ Ametista': 10,
      'üü® Ouro': 15, 'üíé Diamante': 20, 'üü¢ Esmeralda': 30, 'üî¥ Rubi': 50,
      'üåû Pedra do Sol': 100, 'üî∑ Cristal da Lua': 500, '‚òÑ Meteorito': 1500,
      'üß± Tijolo': 3, '‚öí Cimento': 4, 'üåï P√≥ lunar': 200, 'üí´ Plasma': 800,
      '‚ö´ Mat√©ria escura': 5000
    };

    let inventory = {};
    let unlockedItems = {};
    let coins = 0;
    let chestActive = false;
    let currentChest = null;
    let autoMinerUnlocked = false;
    let autoMinerActive = false;
    let doubleMineUnlocked = false;
    let speedUnlocked = false;
    let autoMinerInterval = null;

    // ‚úÖ SALVAMENTO
    function saveGame() {
      localStorage.setItem('miningGameSave_v4', JSON.stringify({
        inventory, unlockedItems, coins,
        autoMinerUnlocked, doubleMineUnlocked, speedUnlocked
      }));
    }

    function loadGame() {
      const data = JSON.parse(localStorage.getItem('miningGameSave_v4') || '{}');
      inventory = data.inventory || {};
      unlockedItems = data.unlockedItems || {};
      coins = data.coins || 0;
      autoMinerUnlocked = data.autoMinerUnlocked || false;
      doubleMineUnlocked = data.doubleMineUnlocked || false;
      speedUnlocked = data.speedUnlocked || false;
    }

    // ‚úÖ RENDER
    function renderInventory() {
      const reg = document.getElementById('regularInventory');
      const exc = document.getElementById('exclusiveInventory');
      const excList = document.getElementById('exclusiveList');

      // Itens comuns
      const comuns = mainItems.filter(i => inventory[i.name] > 0);
      reg.innerHTML = comuns.length ? 
        comuns.map(i => `<div class="inventory-item"><span>${i.name}</span><span>x${inventory[i.name]}</span></div>`).join('') :
        '<div style="text-align:center;color:#777;padding:12px;">Nenhum item comum</div>';

      // Exclusivos
      const excItens = [...exclusiveItems].filter(name => inventory[name] > 0);
      if (excItens.length) {
        const sorted = excItens
          .map(name => ({ name, w: getExcWeight(name) }))
          .sort((a, b) => b.w - a.w)
          .map(x => x.name);
        excList.innerHTML = sorted.map(name => 
          `<div class="inventory-item"><span>${name}</span><span>x${inventory[name]}</span></div>`
        ).join('');
        exc.style.display = 'block';
      } else {
        exc.style.display = 'none';
      }
    }

    function getExcWeight(name) {
      for (const c of chests) {
        const i = c.items.find(x => x.name === name);
        if (i) return i.weight;
      }
      return 0;
    }

    function renderChances() {
      const reg = document.getElementById('regularChances');
      const chest = document.getElementById('chestChances');
      const list = document.getElementById('chestList');

      reg.innerHTML = mainItems.map(i => 
        `<div class="chance-item"><span>${unlockedItems[i.name] ? i.name : 'Item misterioso'}</span><span>${i.weight}</span></div>`
      ).join('');

      let html = '';
      chests.forEach(c => {
        html += `<div class="chance-item"><span>${c.name}</span><span>${c.weight}</span></div>`;
        c.items.forEach(i => {
          html += `<div class="chance-item" style="padding-left:20px;font-size:1.15rem;"><span>- ${unlockedItems[i.name] ? i.name : 'Item misterioso'}</span><span>${i.weight}%</span></div>`;
        });
      });
      list.innerHTML = html;
      chest.style.display = 'block';
    }

    function renderValues() {
      let html = mainItems.map(i => 
        `<div class="value-item"><span>${unlockedItems[i.name] ? i.name : 'Item misterioso'}</span><span>${itemValues[i.name] || 0}</span></div>`
      ).join('');
      
      html += `<div class="section-title">Exclusivos</div>`;
      const allExc = [];
      chests.forEach(c => c.items.forEach(i => allExc.push(i)));
      html += allExc.map(i => 
        `<div class="value-item"><span>${unlockedItems[i.name] ? i.name : 'Item misterioso'}</span><span>${itemValues[i.name] || 0}</span></div>`
      ).join('');
      
      document.getElementById('valuesList').innerHTML = html;
    }

    // ‚úÖ FUN√á√ïES AUX
    function updateCoinsDisplay() {
      document.getElementById('coinsDisplay').textContent = `Moedas: ${coins.toFixed(1)}`;
      saveGame();
    }

    function showNotification(msg, ok = true) {
      const n = document.getElementById('notification');
      n.innerHTML = `<span class="${ok ? 'icon-success' : 'icon-error'}">${ok ? '‚úÖ' : '‚ùå'}</span><span>${msg}</span>`;
      n.style.display = 'flex';
      setTimeout(() => n.style.display = 'none', 5000);
    }

    function getRandomItem(list) {
      const total = list.reduce((s, i) => s + i.weight, 0);
      let r = Math.random() * total;
      for (const i of list) {
        if (r < i.weight) return i;
        r -= i.weight;
      }
      return list[list.length - 1];
    }

    function addToInventory(name) {
      inventory[name] = (inventory[name] || 0) + 1;
      unlockedItems[name] = true;
      saveGame();
    }

    function closeChest() {
      chestActive = false;
      currentChest = null;
      document.getElementById('chestButtons').style.display = 'none';
      document.getElementById('spinButton').disabled = false;
    }

    function updateDisplaysLayout() {
      const container = document.getElementById('displays');
      if (doubleMineUnlocked) {
        if (!document.getElementById('display2')) {
          const d2 = document.createElement('div');
          d2.className = 'display-item';
          d2.id = 'display2';
          d2.textContent = 'Clique em Minerar!';
          container.appendChild(d2);
        }
      } else {
        const d2 = document.getElementById('display2');
        if (d2) d2.remove();
      }
    }

    // ‚úÖ MINERA√á√ÉO
    function doMining() {
      if (document.getElementById('spinButton').disabled) return;
      const dur = speedUnlocked ? 600 : 1200;
      const interval = speedUnlocked ? 30 : 60;
      document.getElementById('spinButton').disabled = true;

      let start = Date.now();
      const anim = setInterval(() => {
        if (Date.now() - start >= dur) {
          clearInterval(anim);
          if (doubleMineUnlocked) {
            const i1 = getRandomItem([...mainItems, ...chests]);
            const i2 = getRandomItem([...mainItems, ...chests]);
            document.getElementById('display1').textContent = i1.name;
            document.getElementById('display2').textContent = i2.name;
            [i1, i2].forEach(i => { if (!i.items) addToInventory(i.name); });
            const baus = [i1, i2].filter(i => i.items);
            if (baus.length) {
              chestActive = true;
              currentChest = baus[0];
              document.getElementById('chestButtons').style.display = 'flex';
              return;
            }
          } else {
            const item = getRandomItem([...mainItems, ...chests]);
            document.getElementById('display1').textContent = item.name;
            if (item.items) {
              chestActive = true;
              currentChest = item;
              document.getElementById('chestButtons').style.display = 'flex';
              return;
            } else {
              addToInventory(item.name);
            }
          }
          setTimeout(() => document.getElementById('spinButton').disabled = false, 500);
        } else {
          const all = [...mainItems, ...chests];
          document.getElementById('display1').textContent = all[Math.floor(Math.random() * all.length)].name;
          if (doubleMineUnlocked) {
            document.getElementById('display2').textContent = all[Math.floor(Math.random() * all.length)].name;
          }
        }
      }, interval);
    }

    // ‚úÖ MINERADOR AUTOM√ÅTICO
    function autoMine() {
      if (!autoMinerActive || document.getElementById('spinButton').disabled) return;
      if (doubleMineUnlocked) {
        const i1 = getRandomItem(mainItems);
        const i2 = getRandomItem(mainItems);
        addToInventory(i1.name);
        addToInventory(i2.name);
        document.getElementById('display1').textContent = i1.name;
        if (document.getElementById('display2')) {
          document.getElementById('display2').textContent = i2.name;
        }
      } else {
        const item = getRandomItem(mainItems);
        addToInventory(item.name);
        document.getElementById('display1').textContent = item.name;
      }
    }

    function toggleAutoMiner() {
      if (!autoMinerUnlocked) return;
      autoMinerActive = !autoMinerActive;
      const btn = document.getElementById('autoMinerBtn');
      btn.className = autoMinerActive ? 'on' : 'off';
      btn.textContent = `Minerador: ${autoMinerActive ? 'ON' : 'OFF'}`;

      if (autoMinerActive) {
        if (autoMinerInterval) clearInterval(autoMinerInterval);
        const time = speedUnlocked ? 600 : 1200;
        autoMinerInterval = setInterval(autoMine, time);
      } else {
        if (autoMinerInterval) clearInterval(autoMinerInterval);
      }
    }

    // ‚úÖ EVENTOS
    document.getElementById('spinButton').onclick = () => {
      const d1 = document.getElementById('display1');
      d1.textContent = 'Clique em Minerar!';
      if (doubleMineUnlocked && document.getElementById('display2')) {
        document.getElementById('display2').textContent = 'Clique em Minerar!';
      }
      doMining();
    };

    document.getElementById('autoMinerBtn').onclick = toggleAutoMiner;

    // Compras
    document.getElementById('buyAutoMiner').onclick = () => {
      if (coins >= 1600 && !autoMinerUnlocked) {
        coins -= 1600;
        autoMinerUnlocked = true;
        document.getElementById('autoMinerBtn').style.display = 'block';
        updateCoinsDisplay();
        showNotification("Minerador Autom√°tico comprado!");
      } else if (autoMinerUnlocked) {
        showNotification("J√° possui este item!", false);
      } else {
        showNotification("Moedas insuficientes!", false);
      }
    };

    document.getElementById('buyDoubleMine').onclick = () => {
      if (coins >= 4250 && !doubleMineUnlocked) {
        coins -= 4250;
        doubleMineUnlocked = true;
        updateDisplaysLayout();
        updateCoinsDisplay();
        showNotification("+1 Mina ativado!");
      } else if (doubleMineUnlocked) {
        showNotification("J√° possui este item!", false);
      } else {
        showNotification("Moedas insuficientes!", false);
      }
    };

    document.getElementById('buySpeed').onclick = () => {
      if (coins >= 4500 && !speedUnlocked) {
        coins -= 4500;
        speedUnlocked = true;
        updateCoinsDisplay();
        showNotification("Velocidade 2.0 ativada!");
      } else if (speedUnlocked) {
        showNotification("J√° possui este item!", false);
      } else {
        showNotification("Moedas insuficientes!", false);
      }
    };

    // Ba√∫
    document.getElementById('ignoreChest').onclick = () => {
      document.getElementById('display1').textContent = "Ba√∫ ignorado.";
      if (doubleMineUnlocked && document.getElementById('display2')) {
        document.getElementById('display2').textContent = "Ba√∫ ignorado.";
      }
      closeChest();
    };

    document.getElementById('openChest').onclick = () => {
      if (coins < 500) {
        showNotification("Moedas insuficientes! (500 necess√°rias)", false);
        return;
      }
      coins -= 500;
      updateCoinsDisplay();
      const reward = getRandomItem(currentChest.items);
      addToInventory(reward.name);
      renderInventory();
      document.getElementById('display1').textContent = `Voc√™ abriu o ba√∫ e ganhou ${reward.name}`;
      if (doubleMineUnlocked && document.getElementById('display2')) {
        document.getElementById('display2').textContent = "";
      }
      closeChest();
    };

    // Venda
    function populateSellDropdown() {
      const sel = document.getElementById('sellItem');
      sel.innerHTML = '<option value="">Selecione um item</option>';
      Object.keys(inventory)
        .filter(name => inventory[name] > 0)
        .forEach(name => {
          const opt = document.createElement('option');
          opt.value = name;
          opt.textContent = `${name} (x${inventory[name]})`;
          sel.appendChild(opt);
        });
    }

    function updatePreviews() {
      const name = document.getElementById('sellItem').value;
      const qty = parseInt(document.getElementById('sellQuantity').value) || 0;
      const p1 = document.getElementById('previewConvert');
      const p2 = document.getElementById('previewConvertAll');

      if (name && inventory[name] > 0) {
        const q = Math.min(qty, inventory[name]);
        p1.textContent = `+${(itemValues[name] * q).toFixed(1)} moedas`;
      } else {
        p1.textContent = '+0 moedas';
      }

      let total = 0;
      for (const n in inventory) {
        if (inventory[n] > 0) total += (itemValues[n] || 0) * inventory[n];
      }
      p2.textContent = `+${total.toFixed(1)} moedas`;
    }

    function sellItem() {
      const name = document.getElementById('sellItem').value;
      const qty = parseInt(document.getElementById('sellQuantity').value) || 0;
      if (!name || !inventory[name] || qty <= 0) {
        showNotification("Selecione um item e quantidade v√°lida.", false);
        return;
      }
      if (qty > inventory[name]) {
        showNotification("Quantidade insuficiente", false);
        return;
      }
      coins += (itemValues[name] || 0) * qty;
      inventory[name] -= qty;
      if (inventory[name] <= 0) delete inventory[name];
      updateCoinsDisplay();
      populateSellDropdown();
      updatePreviews();
      renderInventory();
      showNotification("Voc√™ vendeu os itens");
    }

    function sellAll() {
      let total = 0;
      for (const name in inventory) {
        if (inventory[name] > 0) total += (itemValues[name] || 0) * inventory[name];
      }
      coins += total;
      inventory = {};
      updateCoinsDisplay();
      populateSellDropdown();
      updatePreviews();
      renderInventory();
      showNotification("Voc√™ vendeu todos os itens");
    }

    // ‚úÖ MODAIS
    function setupModal(id) {
      const modal = document.getElementById(id);
      modal.querySelector('.close-btn').onclick = () => modal.style.display = 'none';
      window.onclick = (e) => { if (e.target === modal) modal.style.display = 'none'; };
    }

    document.getElementById('backpackButton').onclick = () => {
      renderInventory();
      document.getElementById('backpackModal').style.display = 'flex';
    };

    document.getElementById('chancesButton').onclick = () => {
      renderChances();
      document.getElementById('chancesModal').style.display = 'flex';
    };

    document.getElementById('valuesButton').onclick = () => {
      renderValues();
      document.getElementById('valuesModal').style.display = 'flex';
    };

    document.getElementById('sellButton').onclick = () => {
      populateSellDropdown();
      updatePreviews();
      document.getElementById('sellModal').style.display = 'flex';
    };

    document.getElementById('shopButton').onclick = () => {
      document.getElementById('shopModal').style.display = 'flex';
    };

    // Setup modais
    ['backpackModal', 'chancesModal', 'valuesModal', 'sellModal', 'shopModal'].forEach(setupModal);

    // Eventos de venda
    document.getElementById('sellItem').onchange = updatePreviews;
    document.getElementById('sellQuantity').oninput = updatePreviews;
    document.getElementById('convertBtn').onclick = sellItem;
    document.getElementById('convertAllBtn').onclick = sellAll;

    // ‚úÖ INICIALIZA√á√ÉO
    loadGame();
    updateCoinsDisplay();
    updateDisplaysLayout();
    if (autoMinerUnlocked) document.getElementById('autoMinerBtn').style.display = 'block';
    renderInventory();
    renderChances();
    renderValues();
    populateSellDropdown();

    // Auto-save
    setInterval(saveGame, 3000);
  </script>
</body>
</html>
