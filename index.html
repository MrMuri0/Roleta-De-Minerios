<!DOCTYPE html>
<html lang="pt-BR">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Roleta de Min√©rios</title>
   <!-- Inclui o Tailwind CSS para estiliza√ß√£o -->
   <script src="https://cdn.tailwindcss.com"></script>
   <style>
       /* Define a fonte Inter para todo o corpo */
       body {
           font-family: 'Inter', sans-serif;
       }
       /* Estilo para o modal */
       .modal-overlay {
           background-color: rgba(0, 0, 0, 0.7);
           z-index: 1000; /* Garante que o modal esteja acima de outros elementos */
       }
       .modal-content {
           z-index: 1001; /* Conte√∫do do modal acima do overlay */
       }
       /* Classes para texto colorido (gradiente) */
       .text-colorful {
           background-clip: text;
           -webkit-background-clip: text;
           color: transparent;
           background-image: linear-gradient(to right, #a78bfa, #ec4899, #ef4444); /* Roxo, Rosa, Vermelho */
       }
       /* Estilo para input com erro */
       .input-error {
           border-color: #ef4444; /* Vermelho */
           color: #ef4444; /* Vermelho */
       }
       /* Classe para fonte extra pequena */
       .text-xxs {
           font-size: 0.65rem; /* Um pouco menor que text-xs (0.75rem) */
       }
   </style>
   <!-- Firebase SDKs -->
   <script type="module">
       import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
       import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
       import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";


       // Vari√°veis globais para Firebase (ser√£o preenchidas pelo ambiente Canvas)
       const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
       const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
       const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;


       // Inicializa o Firebase
       const app = initializeApp(firebaseConfig);
       const db = getFirestore(app);
       const auth = getAuth(app);


       // Exporta as inst√¢ncias para uso no script principal
       window.firebaseApp = app;
       window.firestoreDb = db;
       window.firebaseAuth = auth;
       window.initialAuthToken = initialAuthToken;
       window.appId = appId;
       window.onAuthStateChanged = onAuthStateChanged; // Exporta para o script principal
       window.signInAnonymously = signInAnonymously; // Exporta para o script principal
       window.signInWithCustomToken = signInWithCustomToken; // Exporta para o script principal
       window.doc = doc; // Exporta para o script principal
       window.setDoc = setDoc; // Exporta para o script principal
       window.onSnapshot = onSnapshot; // Exporta para o script principal
   </script>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">
   <div class="bg-gray-800 p-8 rounded-lg shadow-xl text-center max-w-4xl w-full">
       <h1 class="text-3xl font-bold mb-6 text-gray-100">Roleta de Min√©rios</h1>


       <!-- Display de Moedas -->
       <div class="mb-4 text-xl font-bold text-yellow-400">
           Moedas: <span id="coinDisplay">0</span> üí∞
       </div>


       <!-- Cont√™iner para empilhar os bot√µes verticalmente -->
       <div class="flex flex-col items-center mb-8">
           <!-- Bot√£o de Minerar Aumentado -->
           <button id="mineButton"
                   class="bg-white text-gray-900 font-bold py-4 px-10 rounded-full shadow-lg hover:bg-gray-200 focus:outline-none focus:ring-4 focus:ring-white focus:ring-opacity-50 transition duration-300 ease-in-out transform hover:scale-105 mb-4">
               Minerar
           </button>


           <!-- Cont√™iner para os bot√µes secund√°rios (Converter, Invent√°rio, Raridades, Valores) -->
           <!-- As classes aqui ser√£o manipuladas via JavaScript para alternar entre layouts -->
           <div id="secondaryButtonsContainer" class="flex flex-row justify-center space-x-6 px-4">
               <button id="convertButton"
                       class="bg-gray-600 text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-gray-500 focus:outline-none focus:ring-4 focus:ring-gray-400 focus:ring-opacity-50 transition duration-300 ease-in-out transform hover:scale-105">
                   Converter
               </button>
               <button id="inventoryButton"
                       class="bg-gray-600 text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-gray-500 focus:outline-none focus:ring-4 focus:ring-gray-400 focus:ring-opacity-50 transition duration-300 ease-in-out transform hover:scale-105">
                   Invent√°rio
               </button>
               <button id="raritiesButton"
                       class="bg-gray-600 text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-gray-500 focus:outline-none focus:ring-4 focus:ring-gray-400 focus:ring-opacity-50 transition duration-300 ease-in-out transform hover:scale-105">
                   Raridades
               </button>
               <button id="valuesButton"
                       class="bg-gray-600 text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-gray-500 focus:outline-none focus:ring-4 focus:ring-gray-400 focus:ring-opacity-50 transition duration-300 ease-in-out transform hover:scale-105">
                   Valores
               </button>
           </div>
       </div>


       <!-- Mostrador do Item Obtido -->
       <div class="mt-8 p-4 bg-gray-700 rounded-lg text-lg font-semibold text-gray-200">
           <p id="resultDisplay" class="whitespace-nowrap overflow-hidden">Clique em "Minerar" para come√ßar!</p>
       </div>


       <!-- Op√ß√µes do Ba√∫ (movido para cima) -->
       <div id="chestOptions" class="mt-4 hidden">
           <div class="flex justify-center space-x-4">
               <button id="ignoreChestButton"
                       class="bg-red-500 text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-red-600 focus:outline-none focus:ring-4 focus:ring-red-400 focus:ring-opacity-50 transition duration-300 ease-in-out">
                   Ignorar
               </button>
               <button id="buyChestButton"
                       class="bg-green-500 text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-green-600 focus:outline-none focus:ring-4 focus:ring-green-400 focus:ring-opacity-50 transition duration-300 ease-in-out">
                   Comprar por 500 Moedas
               </button>
           </div>
           <p id="coinMessage" class="text-red-400 mt-2 hidden">Moedas insuficientes!</p>
       </div>


       <!-- Bot√µes de Sele√ß√£o de Layout (movido para baixo) -->
       <div class="flex justify-center space-x-4 mt-8 mb-4">
           <button id="computerButton" class="bg-gray-600 text-white font-bold py-2 px-4 rounded-full shadow-lg hover:bg-gray-500 focus:outline-none focus:ring-4 focus:ring-gray-400 transition duration-300 ease-in-out">
               Computador
           </button>
           <button id="mobileButton" class="bg-gray-600 text-white font-bold py-2 px-4 rounded-full shadow-lg hover:bg-gray-500 focus:outline-none focus:ring-4 focus:ring-gray-400 transition duration-300 ease-in-out">
               Celular
           </button>
       </div>
   </div>


   <!-- Modal gen√©rico para Invent√°rio, Raridades, Converter e Valores -->
   <div id="infoModal" class="fixed inset-0 flex items-center justify-center hidden modal-overlay">
       <div class="bg-gray-700 p-8 rounded-lg shadow-xl text-center max-w-sm w-full modal-content relative">
           <h2 id="modalTitle" class="text-2xl font-bold mb-4 text-gray-100"></h2>
           <!-- Bot√£o 'X' para fechar o modal -->
           <button id="closeModalButton"
                   class="absolute top-4 right-4 text-gray-400 hover:text-gray-200 text-3xl font-bold leading-none focus:outline-none">
               &times;
           </button>
           <div id="modalContent" class="text-left text-gray-200 max-h-60 overflow-y-auto pr-2">
               <!-- Conte√∫do (invent√°rio, raridades, converter ou valores) ser√° injetado aqui -->
           </div>
       </div>
   </div>


   <script>
       // Vari√°veis globais do Firebase (exportadas do script 'module' acima)
       let firestoreDb;
       let firebaseAuth;
       let initialAuthToken;
       let appId;
       let onAuthStateChanged;
       let signInAnonymously;
       let signInWithCustomToken;
       let doc;
       let setDoc;
       let onSnapshot;


       // Aguarda o carregamento do DOM e das vari√°veis do Firebase
       window.onload = async () => {
           // Atribui as vari√°veis globais do Firebase
           firestoreDb = window.firestoreDb;
           firebaseAuth = window.firebaseAuth;
           initialAuthToken = window.initialAuthToken;
           appId = window.appId;
           onAuthStateChanged = window.onAuthStateChanged;
           signInAnonymously = window.signInAnonymously;
           signInWithCustomToken = window.signInWithCustomToken;
           doc = window.doc;
           setDoc = window.setDoc;
           onSnapshot = window.onSnapshot;


           // Autentica o usu√°rio
           onAuthStateChanged(firebaseAuth, async (user) => {
               if (!user) {
                   try {
                       if (initialAuthToken) {
                           await signInWithCustomToken(firebaseAuth, initialAuthToken);
                       } else {
                           await signInAnonymously(firebaseAuth);
                       }
                   } catch (error) {
                       console.error("Erro na autentica√ß√£o Firebase:", error);
                   }
               }
               // Carrega os dados do jogo ap√≥s a autentica√ß√£o
               loadGameData();
           });


           // Inicializa a exibi√ß√£o de moedas ao carregar a p√°gina
           updateCoinDisplay();
           // Define a mensagem inicial no mostrador
           updateResultDisplay(currentMainMessage, false);
           // Define o layout inicial como computador
           setDesktopLayout();
       };


       // Define os itens e suas respectivas "pesos" (proporcional √†s porcentagens)
       const items = [
           { name: 'üå≥ Terra', weight: 17 },
           { name: 'ü™ì Madeira', weight: 12 },
           { name: 'üåë Pedra', weight: 9 },
           { name: '‚¨õ Obsidiana', weight: 8 },
           { name: 'üî∂ Cobre', weight: 6.5 },
           { name: 'üî© Ferro', weight: 7 },
           { name: '‚¨ú Quartzo', weight: 5.2 },
           { name: 'üü£ Ametista', weight: 4 },
           { name: 'üü® Ouro', weight: 2.5 },
           { name: 'üíé Diamante', weight: 1.5 },
           { name: 'üü¢ Esmeralda', weight: 1.2 },
           { name: 'üî¥ Rubi', weight: 0.7 },
           { name: 'üåû Pedra do Sol', weight: 0.5 },
           { name: 'üî∑ Cristal da Lua', weight: 0.02 },
           { name: '‚òÑ Meteorito', weight: 0.007 },
           { name: 'üéÅ Ba√∫', weight: 4 } // Item Ba√∫
       ];


       // Define os itens que podem vir dentro do ba√∫ e suas chances
       const chestItems = [
           { name: 'üü¢ Esmeralda', weight: 0.8 },
           { name: 'üî¥ Rubi', weight: 0.7 },
           { name: 'üåû Pedra do Sol', weight: 0.5 },
           { name: 'üî∑ Cristal da Lua', weight: 0.2 },
           { name: '‚òÑ Meteorito', weight: 0.1 }
       ];


       // Valores de convers√£o de itens para moedas
       const itemCoinValues = {
           'üå≥ Terra': 0.5,
           'ü™ì Madeira': 1,
           'üåë Pedra': 2,
           '‚¨õ Obsidiana': 5,
           'üî∂ Cobre': 6.5,
           'üî© Ferro': 7.5,
           '‚¨ú Quartzo': 8,
           'üü£ Ametista': 10,
           'üü® Ouro': 15,
           'üíé Diamante': 20,
           'üü¢ Esmeralda': 30,
           'üî¥ Rubi': 50,
           'üåû Pedra do Sol': 100,
           'üî∑ Cristal da Lua': 500,
           '‚òÑ Meteorito': 1500
       };


       // Calcula a soma total dos pesos para normaliza√ß√£o dos itens de minera√ß√£o
       const totalWeight = items.reduce((sum, item) => sum + item.weight, 0);
       // Calcula a soma total dos pesos para normaliza√ß√£o dos itens do ba√∫
       const totalChestWeight = chestItems.reduce((sum, item) => sum + item.weight, 0);




       // Refer√™ncias aos elementos HTML
       const mineButton = document.getElementById('mineButton');
       const inventoryButton = document.getElementById('inventoryButton');
       const raritiesButton = document.getElementById('raritiesButton');
       const convertButton = document.getElementById('convertButton');
       const valuesButton = document.getElementById('valuesButton');
       const resultDisplay = document.getElementById('resultDisplay');
       const infoModal = document.getElementById('infoModal');
       const modalTitle = document.getElementById('modalTitle');
       const modalContent = document.getElementById('modalContent');
       const closeModalButton = document.getElementById('closeModalButton');
       const coinDisplay = document.getElementById('coinDisplay');
       const chestOptions = document.getElementById('chestOptions');
       const ignoreChestButton = document.getElementById('ignoreChestButton');
       const buyChestButton = document.getElementById('buyChestButton');
       const coinMessage = document.getElementById('coinMessage');


       // Novos bot√µes de layout
       const computerButton = document.getElementById('computerButton');
       const mobileButton = document.getElementById('mobileButton');
       const secondaryButtonsContainer = document.getElementById('secondaryButtonsContainer');




       let animationInterval;
       let inventory = {};
       let coins = 0; // Moedas iniciais


       let currentMainMessage = 'Clique em "Minerar" para come√ßar!'; // Mensagem "permanente" no mostrador
       let messageTimeoutId = null; // ID para o timeout das mensagens tempor√°rias
       let discoveredItems = new Set(); // Conjunto para armazenar itens j√° descobertos
       let isMining = false; // Flag para evitar cliques m√∫ltiplos durante a minera√ß√£o


       let saveTimeoutId = null; // Para debouncing do salvamento
       const SAVE_DELAY = 1000; // Salva a cada 1 segundo ap√≥s a √∫ltima altera√ß√£o


       // Fun√ß√£o para salvar os dados do jogo no Firestore (com debouncing)
       function saveGameData() {
           if (!firestoreDb || !firebaseAuth.currentUser) {
               console.warn("Firestore ou usu√°rio n√£o autenticado. N√£o √© poss√≠vel salvar os dados.");
               return;
           }


           if (saveTimeoutId) {
               clearTimeout(saveTimeoutId);
           }


           saveTimeoutId = setTimeout(async () => {
               const userId = firebaseAuth.currentUser.uid;
               const gameDocRef = doc(firestoreDb, `artifacts/${appId}/users/${userId}/gameData/current`);
               try {
                   await setDoc(gameDocRef, {
                       inventory: inventory,
                       coins: coins,
                       discoveredItems: Array.from(discoveredItems) // Converte Set para Array para salvar
                   });
                   console.log("Dados do jogo salvos com sucesso!");
               } catch (e) {
                   console.error("Erro ao salvar dados do jogo:", e);
               }
           }, SAVE_DELAY);
       }


       // Fun√ß√£o para carregar os dados do jogo do Firestore
       function loadGameData() {
           if (!firestoreDb) {
               console.warn("Firestore n√£o inicializado. N√£o √© poss√≠vel carregar os dados.");
               return;
           }


           // Garante que o usu√°rio esteja autenticado antes de tentar carregar
           onAuthStateChanged(firebaseAuth, (user) => {
               if (user) {
                   const userId = user.uid;
                   const gameDocRef = doc(firestoreDb, `artifacts/${appId}/users/${userId}/gameData/current`);


                   onSnapshot(gameDocRef, (docSnap) => {
                       if (docSnap.exists()) {
                           const data = docSnap.data();
                           inventory = data.inventory || {};
                           coins = data.coins || 0;
                           discoveredItems = new Set(data.discoveredItems || []); // Converte Array para Set ao carregar
                           updateCoinDisplay();
                           console.log("Dados do jogo carregados com sucesso!");
                       } else {
                           console.log("Nenhum dado de jogo encontrado para este usu√°rio. Iniciando novo jogo.");
                           // Se n√£o houver dados, salva o estado inicial para criar o documento
                           saveGameData();
                       }
                   }, (error) => {
                       console.error("Erro ao carregar dados do jogo em tempo real:", error);
                   });
               } else {
                   console.log("Aguardando autentica√ß√£o para carregar dados do jogo.");
               }
           });
       }


       // Fun√ß√£o para atualizar a exibi√ß√£o de moedas
       function updateCoinDisplay() {
           coinDisplay.textContent = coins;
       }


       // Fun√ß√£o para atualizar o mostrador de resultados com l√≥gica de fonte e temporiza√ß√£o
       function updateResultDisplay(message, isTemporary = false) {
           // Limpa qualquer timeout existente para evitar sobreposi√ß√£o de mensagens
           if (messageTimeoutId) {
               clearTimeout(messageTimeoutId);
               messageTimeoutId = null;
           }


           const resultDisplayElement = document.getElementById('resultDisplay');
           // Remove todas as classes de tamanho de fonte para aplicar a correta
           resultDisplayElement.classList.remove('text-lg', 'text-base', 'text-sm', 'text-xs', 'text-xxs', 'text-xl');


           // L√≥gica de ajuste de fonte mais agressiva para garantir que caiba em uma linha
           // Ajusta os limites de comprimento para cada tamanho de fonte
           if (message.length > 60) { // Mensagens muito, muito longas
               resultDisplayElement.classList.add('text-xxs');
           } else if (message.length > 50) { // Muito longo
               resultDisplayElement.classList.add('text-xs');
           } else if (message.length > 40) { // Longo
               resultDisplayElement.classList.add('text-sm');
           } else if (message.length > 30) { // M√©dio
               resultDisplayElement.classList.add('text-base');
           } else if (message.length > 20) { // Um pouco maior
               resultDisplayElement.classList.add('text-lg');
           } else { // Curto
               resultDisplayElement.classList.add('text-xl'); // Tamanho padr√£o
           }


           resultDisplayElement.textContent = message;
           resultDisplayElement.classList.remove('hidden'); // Garante que o mostrador esteja vis√≠vel


           if (isTemporary) {
               messageTimeoutId = setTimeout(() => {
                   // Ao reverter, o mostrador deve voltar ao estado anterior
                   // Se o ba√∫ est√° vis√≠vel, garante que a mensagem do ba√∫ e suas op√ß√µes voltem
                   if (!chestOptions.classList.contains('hidden')) {
                       updateResultDisplay('Voc√™ encontrou um üéÅ Ba√∫!', false); // Reaplicar a l√≥gica de fonte para a mensagem do ba√∫
                   } else {
                       updateResultDisplay(currentMainMessage, false); // Reaplicar a l√≥gica de fonte para a mensagem principal
                   }
               }, 2000); // 2 segundos
           } else {
               currentMainMessage = message; // Atualiza a mensagem permanente
           }
       }


       // Fun√ß√£o para simular a minera√ß√£o e determinar o item final
       function getRandomMinedItem() {
           let randomNumber = Math.random() * totalWeight;
           for (const item of items) {
               randomNumber -= item.weight;
               if (randomNumber <= 0) {
                   return item.name;
               }
           }
           return 'Nenhum item encontrado'; // Fallback
       }


       // Nova fun√ß√£o para sortear um item do ba√∫
       function getRandomChestItem() {
           let randomNumber = Math.random() * totalChestWeight;
           for (const item of chestItems) {
               randomNumber -= item.weight;
               if (randomNumber <= 0) {
                   return item.name;
               }
           }
           return 'Nenhum item do ba√∫ encontrado'; // Fallback
       }


       // Fun√ß√£o para iniciar a anima√ß√£o de roletar
       function startAnimation(finalItem) {
           if (animationInterval) {
               clearInterval(animationInterval);
           }


           // Desabilita o bot√£o de minera√ß√£o durante a anima√ß√£o
           mineButton.disabled = true;
           // Os outros bot√µes permanecem habilitados
           inventoryButton.disabled = false;
           raritiesButton.disabled = false;
           convertButton.disabled = false;
           valuesButton.disabled = false;


           updateResultDisplay(`Roletando... ${items[Math.floor(Math.random() * items.length)].name}`);


           animationInterval = setInterval(() => {
               const randomIndex = Math.floor(Math.random() * items.length);
               updateResultDisplay(`Roletando... ${items[randomIndex].name}`);
           }, 50);


           setTimeout(() => {
               clearInterval(animationInterval);


               if (finalItem === 'üéÅ Ba√∫') {
                   updateResultDisplay('Voc√™ encontrou um üéÅ Ba√∫!', false); // Mensagem no mostrador
                   chestOptions.classList.remove('hidden');
                   coinMessage.classList.add('hidden');
                   mineButton.disabled = true; // Mant√©m o bot√£o de minera√ß√£o desabilitado at√© interagir com o ba√∫
                   isMining = false; // Libera o flag de minera√ß√£o para permitir intera√ß√£o com o ba√∫
               } else {
                   updateResultDisplay(`Voc√™ minerou: ${finalItem}`, false);
                   inventory[finalItem] = (inventory[finalItem] || 0) + 1; // Adiciona 1 ao invent√°rio
                   discoveredItems.add(finalItem); // Adiciona o item aos descobertos
                   saveGameData(); // Salva os dados ap√≥s a minera√ß√£o
                   // Cooldown de 0.5 segundo para o bot√£o de minera√ß√£o
                   setTimeout(() => {
                       mineButton.disabled = false;
                       isMining = false; // Libera o flag de minera√ß√£o ap√≥s o cooldown
                   }, 500);
               }
           }, 1000);
       }


       // Fun√ß√£o principal de minera√ß√£o
       function mine() {
           // Se j√° estiver minerando ou se as op√ß√µes do ba√∫ estiverem vis√≠veis, n√£o permite minerar
           if (isMining || !chestOptions.classList.contains('hidden')) {
               return;
           }
           isMining = true; // Define o flag de minera√ß√£o
           const finalItem = getRandomMinedItem();
           startAnimation(finalItem);
       }


       // Fun√ß√£o para lidar com o bot√£o "Ignorar" do ba√∫
       function handleIgnoreChest() {
           chestOptions.classList.add('hidden');
           updateResultDisplay('Voc√™ ignorou o ba√∫.', false);
           mineButton.disabled = false; // Reabilita o bot√£o de minera√ß√£o
           isMining = false; // Libera o flag de minera√ß√£o
       }


       // Fun√ß√£o para lidar com o bot√£o "Comprar" do ba√∫
       function handleBuyChest() {
           const cost = 500;
           if (coins >= cost) {
               coins -= cost;
               updateCoinDisplay();
               chestOptions.classList.add('hidden');


               const minedChestItem = getRandomChestItem();
               inventory[minedChestItem] = (inventory[minedChestItem] || 0) + 1; // Adiciona 1 ao invent√°rio
               discoveredItems.add(minedChestItem); // Adiciona o item do ba√∫ aos descobertos
               updateResultDisplay(`Voc√™ abriu o ba√∫ e ganhou: ${minedChestItem}!`, false);
               saveGameData(); // Salva os dados ap√≥s a compra do ba√∫


               mineButton.disabled = false; // Reabilita o bot√£o de minera√ß√£o
               isMining = false; // Libera o flag de minera√ß√£o
           } else {
               coinMessage.classList.remove('hidden');
           }
       }


       // Fun√ß√£o para exibir o invent√°rio
       function showInventory() {
           let contentHtml = '';
           modalTitle.textContent = 'Seu Invent√°rio';


           // Mapeia todos os itens definidos (minera√ß√£o e ba√∫) para f√°cil acesso ao peso
           const allDefinedItemsMap = new Map();
           items.forEach(item => allDefinedItemsMap.set(item.name, item));
           chestItems.forEach(item => allDefinedItemsMap.set(item.name, item));


           const inventoryItemsWithWeights = Object.keys(inventory).map(itemName => {
               const itemDefinition = allDefinedItemsMap.get(itemName);
               return {
                   name: itemName,
                   count: inventory[itemName],
                   weight: itemDefinition ? itemDefinition.weight : 0 // Adiciona o peso para ordena√ß√£o
               };
           });


           // Ordena os itens do invent√°rio por peso (raridade), do mais comum (maior peso) para o mais raro
           inventoryItemsWithWeights.sort((a, b) => b.weight - a.weight);


           if (inventoryItemsWithWeights.length === 0) {
               contentHtml = '<p>Nenhum item no invent√°rio ainda.</p>';
           } else {
               contentHtml = '<div class="space-y-2">';
               for (const item of inventoryItemsWithWeights) {
                   contentHtml += `
                       <div class="flex justify-between items-center text-lg">
                           <span>${item.name}</span>
                           <span class="font-bold text-gray-100">${item.count}X</span>
                       </div>
                   `;
               }
               contentHtml += '</div>';
           }
           modalContent.innerHTML = contentHtml;
           infoModal.classList.remove('hidden');
       }


       // Fun√ß√£o para exibir as raridades
       function showRarities() {
           let contentHtml = '';
           modalTitle.textContent = 'Raridades dos Min√©rios';


           contentHtml = '<div class="space-y-2">';


           const uniqueItemsMap = new Map();


           // Adiciona itens da lista principal
           items.filter(item => item.name !== 'üéÅ Ba√∫').forEach(item => {
               uniqueItemsMap.set(item.name, item);
           });


           // Adiciona itens do ba√∫, mas s√≥ se ainda n√£o estiverem no mapa (prioriza a defini√ß√£o da lista principal)
           chestItems.forEach(item => {
               if (!uniqueItemsMap.has(item.name)) {
                   uniqueItemsMap.set(item.name, item);
               }
           });


           const allSortableItems = Array.from(uniqueItemsMap.values());
           allSortableItems.sort((a, b) => b.weight - a.weight); // Ordena por peso (raridade)


           for (const item of allSortableItems) {
               // Verifica se o item foi descoberto (se j√° esteve no invent√°rio)
               const isDiscovered = discoveredItems.has(item.name);
               const finalDisplayName = isDiscovered ? item.name : '? Item misterioso';


               contentHtml += `
                   <div class="flex justify-between items-center text-lg">
                       <span>${finalDisplayName}</span>
                       <span class="font-bold text-gray-100">${item.weight}%</span>
                   </div>
               `;
           }


           const chestItem = items.find(item => item.name === 'üéÅ Ba√∫');
           if (chestItem) {
               const isDiscovered = discoveredItems.has(chestItem.name);
               const rarityText = `${chestItem.weight}%`;


               let chestDisplayNameHtml;
               if (isDiscovered) {
                   const emoji = chestItem.name.split(' ')[0];
                   const namePart = chestItem.name.substring(emoji.length).trim();
                   chestDisplayNameHtml = `<span>${emoji} <span class="text-colorful">${namePart}</span></span>`;
               } else {
                   chestDisplayNameHtml = `<span class="text-colorful">? Item misterioso</span>`;
               }


               contentHtml += `
                   <div class="mt-6 pt-4 border-t border-gray-600">
                       <h3 class="text-xl font-bold mb-2 text-gray-100 text-center">--- Especiais ---</h3>
                       <div class="flex justify-between items-center text-lg">
                           ${chestDisplayNameHtml}
                           <span class="font-bold text-gray-100">${rarityText}</span>
                       </div>
                   </div>
               `;
           }


           contentHtml += '</div>';


           modalContent.innerHTML = contentHtml;
           infoModal.classList.remove('hidden');
       }


       // Nova fun√ß√£o para exibir os valores dos itens
       function showValues() {
           modalTitle.textContent = 'Valores dos Min√©rios';
           let valuesHtml = '';


           const allValuableItems = Object.keys(itemCoinValues).map(itemName => {
               return {
                   name: itemName,
                   value: itemCoinValues[itemName]
               };
           });


           // Mapeia todos os itens definidos (minera√ß√£o e ba√∫) para f√°cil acesso ao peso para ordena√ß√£o
           const allDefinedItemsMap = new Map();
           items.forEach(item => allDefinedItemsMap.set(item.name, item));
           chestItems.forEach(item => allDefinedItemsMap.set(item.name, item));


           const valuableItemsWithWeights = allValuableItems.map(item => {
               const itemDefinition = allDefinedItemsMap.get(item.name);
               return {
                   ...item,
                   weight: itemDefinition ? itemDefinition.weight : 0 // Adiciona o peso para ordena√ß√£o
               };
           });


           // Ordena os itens por raridade (peso) para consist√™ncia com o invent√°rio
           valuableItemsWithWeights.sort((a, b) => b.weight - a.weight);




           if (valuableItemsWithWeights.length === 0) {
               valuesHtml = '<p>Nenhum item com valor de convers√£o definido.</p>';
           } else {
               valuesHtml = '<div class="space-y-2">';
               for (const item of valuableItemsWithWeights) {
                   const isDiscovered = discoveredItems.has(item.name);
                   const finalDisplayName = isDiscovered ? item.name : '? Item misterioso';


                   valuesHtml += `
                       <div class="flex justify-between items-center text-lg">
                           <span>${finalDisplayName}</span>
                           <span class="font-bold text-yellow-400">${item.value} Moedas</span>
                       </div>
                   `;
               }
               valuesHtml += '</div>';
           }
           modalContent.innerHTML = valuesHtml;
           infoModal.classList.remove('hidden');
       }




       // Fun√ß√£o para exibir o modal de convers√£o
       function showConverter() {
           modalTitle.textContent = 'Converter Itens em Moedas';
           let conversionHtml = '';
           const availableItems = Object.keys(inventory).filter(item => inventory[item] > 0 && itemCoinValues[item] !== undefined);


           if (availableItems.length === 0) {
               conversionHtml = '<p>Voc√™ n√£o tem itens para converter.</p>';
           } else {
               conversionHtml = `
                   <div class="space-y-4">
                       <div class="flex flex-col items-start">
                           <label for="itemSelect" class="mb-2 text-gray-200">Item:</label>
                           <select id="itemSelect" class="w-full p-2 rounded-md bg-gray-800 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-400">
                               ${availableItems.map(item => `<option value="${item}">${item}</option>`).join('')}
                           </select>
                       </div>
                       <div class="flex flex-col items-start">
                           <label for="quantityInput" class="mb-2 text-gray-200">Quantidade:</label>
                           <input type="number" id="quantityInput" min="1" value="1" class="w-full p-2 rounded-md bg-gray-800 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-400">
                           <p id="currentQuantityDisplay" class="text-gray-400 text-sm mt-1"></p>
                       </div>
                       <p id="conversionMessage" class="text-red-400 hidden"></p>


                       <!-- Bot√µes de Converter e Converter Tudo com seus displays de resultado -->
                       <div class="flex justify-center space-x-4 w-full">
                           <div class="flex flex-col items-center">
                               <button id="confirmConvertButton"
                                       class="bg-green-500 text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-green-600 focus:outline-none focus:ring-4 focus:ring-green-400 focus:ring-opacity-50 transition duration-300 ease-in-out">
                                   Converter
                               </button>
                               <p id="estimatedCoinsDisplay" class="text-yellow-400 text-sm font-bold mt-1">0 üí∞</p>
                           </div>
                           <div class="flex flex-col items-center">
                               <button id="convertAllButton"
                                       class="bg-blue-500 text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-blue-600 focus:outline-none focus:ring-4 focus:ring-blue-400 focus:ring-opacity-50 transition duration-300 ease-in-out">
                                   Converter Tudo
                               </button>
                               <p id="estimatedCoinsAllDisplay" class="text-yellow-400 text-sm font-bold mt-1">0 üí∞</p>
                           </div>
                       </div>
                   </div>
               `;
           }
           modalContent.innerHTML = conversionHtml;
           infoModal.classList.remove('hidden');


           // Refer√™ncias aos elementos dentro do modal (precisam ser re-obtidas ap√≥s a renderiza√ß√£o)
           const itemSelect = document.getElementById('itemSelect');
           const quantityInput = document.getElementById('quantityInput');
           const currentQuantityDisplay = document.getElementById('currentQuantityDisplay');
           const estimatedCoinsDisplay = document.getElementById('estimatedCoinsDisplay');
           const estimatedCoinsAllDisplay = document.getElementById('estimatedCoinsAllDisplay'); // Novo display
           const confirmConvertButton = document.getElementById('confirmConvertButton');
           const convertAllButton = document.getElementById('convertAllButton'); // Novo bot√£o
           const conversionMessage = document.getElementById('conversionMessage');


           // Fun√ß√£o para atualizar as informa√ß√µes de convers√£o
           function updateConversionInfo() {
               const selectedItemName = itemSelect.value;
               const quantityToConvert = parseInt(quantityInput.value);
               const currentItemCount = inventory[selectedItemName] || 0;
               const valuePerItem = itemCoinValues[selectedItemName] || 0;


               const totalCoinsGained = valuePerItem * quantityToConvert;
              
               // Calcular o total de moedas para "Converter Tudo" de TODOS os itens
               let totalCoinsGainedAllInventory = 0;
               let hasConvertibleItemsInInventory = false;
               for (const item in inventory) {
                   if (inventory[item] > 0 && itemCoinValues[item] !== undefined) {
                       totalCoinsGainedAllInventory += inventory[item] * itemCoinValues[item];
                       hasConvertibleItemsInInventory = true;
                   }
               }


               currentQuantityDisplay.textContent = `Voc√™ tem: ${currentItemCount}X`;
               estimatedCoinsDisplay.textContent = `${totalCoinsGained} ÔøΩ`;
               estimatedCoinsAllDisplay.textContent = `${totalCoinsGainedAllInventory} üí∞`; // Atualiza para o total de todos os itens


               // Valida√ß√£o visual da quantidade para o bot√£o "Converter"
               if (quantityToConvert > currentItemCount || quantityToConvert <= 0 || isNaN(quantityToConvert)) {
                   quantityInput.classList.add('input-error');
                   confirmConvertButton.disabled = true;
                   if (quantityToConvert > currentItemCount) {
                       conversionMessage.textContent = 'Quantidade maior que a dispon√≠vel!';
                   } else if (quantityToConvert <= 0 || isNaN(quantityToConvert)) {
                        conversionMessage.textContent = 'Quantidade inv√°lida!';
                   }
                   conversionMessage.classList.remove('hidden', 'text-green-400');
                   conversionMessage.classList.add('text-red-400');
               } else {
                   quantityInput.classList.remove('input-error');
                   confirmConvertButton.disabled = false;
                   conversionMessage.classList.add('hidden'); // Esconde a mensagem de erro se for v√°lido
               }


               // Habilita/Desabilita o bot√£o "Converter Tudo"
               if (!hasConvertibleItemsInInventory) { // Verifica se h√° QUALQUER item convert√≠vel
                   convertAllButton.disabled = true;
               } else {
                   convertAllButton.disabled = false;
               }
           }


           // Adiciona event listeners
           if (itemSelect) itemSelect.addEventListener('change', updateConversionInfo);
           if (quantityInput) quantityInput.addEventListener('input', updateConversionInfo);
           if (confirmConvertButton) confirmConvertButton.addEventListener('click', handleConvert);
           if (convertAllButton) convertAllButton.addEventListener('click', handleConvertAll);


           // Inicializa as informa√ß√µes ao abrir o modal
           if (itemSelect && quantityInput) {
               updateConversionInfo();
           }
       }


       // Fun√ß√£o para lidar com a convers√£o de itens (quantidade espec√≠fica)
       function handleConvert() {
           const itemSelect = document.getElementById('itemSelect');
           const quantityInput = document.getElementById('quantityInput');
           const conversionMessage = document.getElementById('conversionMessage');


           const selectedItemName = itemSelect.value;
           const quantityToConvert = parseInt(quantityInput.value);
           const currentItemCount = inventory[selectedItemName] || 0;


           // Valida√ß√µes (redundantes, mas importantes para a l√≥gica de convers√£o final)
           if (!selectedItemName || itemCoinValues[selectedItemName] === undefined) {
               conversionMessage.textContent = 'Selecione um item v√°lido.';
               conversionMessage.classList.remove('hidden');
               conversionMessage.classList.add('text-red-400');
               return;
           }
           if (isNaN(quantityToConvert) || quantityToConvert <= 0) {
               conversionMessage.textContent = 'Quantidade inv√°lida.';
               conversionMessage.classList.remove('hidden');
               conversionMessage.classList.add('text-red-400');
               return;
           }
           if (currentItemCount < quantityToConvert) {
               conversionMessage.textContent = `Voc√™ n√£o tem ${quantityToConvert} de ${selectedItemName}. Voc√™ tem ${currentItemCount}.`;
               conversionMessage.classList.remove('hidden');
               conversionMessage.classList.add('text-red-400');
               return;
           }


           const valuePerItem = itemCoinValues[selectedItemName];
           const totalCoinsGained = valuePerItem * quantityToConvert;


           // Realiza a convers√£o
           inventory[selectedItemName] -= quantityToConvert;
           if (inventory[selectedItemName] === 0) {
               delete inventory[selectedItemName];
           }
           coins += totalCoinsGained;
           updateCoinDisplay();
           saveGameData(); // Salva os dados ap√≥s a convers√£o


           updateResultDisplay(`Convertido ${quantityToConvert} ${selectedItemName} por ${totalCoinsGained} Moedas!`, true);
           closeModal(); // Fecha o modal ap√≥s a convers√£o
       }


       // Nova fun√ß√£o para lidar com a convers√£o de TODOS os itens do invent√°rio
       function handleConvertAll() {
           let totalCoinsGainedAll = 0;
           let convertedItemsCount = 0; // Para verificar se algo foi convertido


           // Cria uma c√≥pia das chaves do invent√°rio para iterar, pois o invent√°rio ser√° modificado
           const itemsToConvert = Object.keys(inventory);


           for (const itemName of itemsToConvert) {
               // Verifica se o item existe no invent√°rio e tem um valor de convers√£o
               if (inventory[itemName] > 0 && itemCoinValues[itemName] !== undefined) {
                   const quantity = inventory[itemName];
                   const valuePerItem = itemCoinValues[itemName];
                   const coinsForThisItem = valuePerItem * quantity;


                   totalCoinsGainedAll += coinsForThisItem;
                   convertedItemsCount++;


                   delete inventory[itemName]; // Remove o item do invent√°rio
               }
           }


           if (convertedItemsCount > 0) {
               coins += totalCoinsGainedAll;
               updateCoinDisplay();
               saveGameData(); // Salva os dados ap√≥s a convers√£o de todos os itens


               updateResultDisplay('Voc√™ converteu tudo!', true); // Mensagem simplificada
           } else {
               updateResultDisplay('Nenhum item para converter.', true);
           }


           closeModal(); // Fecha o modal ap√≥s a convers√£o
       }




       // Fun√ß√£o para fechar o modal gen√©rico
       function closeModal() {
           infoModal.classList.add('hidden');
           mineButton.disabled = false;
           inventoryButton.disabled = false;
           raritiesButton.disabled = false;
           convertButton.disabled = false;
           valuesButton.disabled = false; // Reabilita o bot√£o de valores
       }


       // Fun√ß√µes para alternar o layout dos bot√µes secund√°rios
       function setDesktopLayout() {
           secondaryButtonsContainer.classList.remove('grid', 'grid-cols-2', 'gap-4', 'w-full'); // Remove w-full do container
           secondaryButtonsContainer.classList.add('flex', 'flex-row', 'justify-center', 'space-x-6', 'px-4');
           // Remove w-full de todos os bot√µes para que eles n√£o ocupem a largura total em desktop
           secondaryButtonsContainer.querySelectorAll('button').forEach(btn => btn.classList.remove('w-full'));
       }


       function setMobileLayout() {
           secondaryButtonsContainer.classList.remove('flex', 'flex-row', 'justify-center', 'space-x-6', 'px-4'); // Remove classes de desktop
           secondaryButtonsContainer.classList.add('grid', 'grid-cols-2', 'gap-4', 'w-full'); // Adiciona w-full ao container
           // Adiciona w-full a todos os bot√µes para que ocupem a largura total dentro de suas c√©lulas da grade
           secondaryButtonsContainer.querySelectorAll('button').forEach(btn => btn.classList.add('w-full'));
       }




       // Adiciona ouvintes de evento
       mineButton.addEventListener('click', mine);
       inventoryButton.addEventListener('click', showInventory);
       raritiesButton.addEventListener('click', showRarities);
       convertButton.addEventListener('click', showConverter);
       valuesButton.addEventListener('click', showValues);
       closeModalButton.addEventListener('click', closeModal);
       ignoreChestButton.addEventListener('click', handleIgnoreChest);
       buyChestButton.addEventListener('click', handleBuyChest);


       // Ouvintes para os novos bot√µes de layout
       computerButton.addEventListener('click', setDesktopLayout);
       mobileButton.addEventListener('click', setMobileLayout);


       // Fecha o modal ao clicar fora dele
       infoModal.addEventListener('click', (event) => {
           if (event.target === infoModal) {
               closeModal();
           }
       });
   </script>
</body>
</html>
ÔøΩ

